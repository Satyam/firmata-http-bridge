<html>
  <head>
    <style>
      pre {
        float: right;
        border: silver thin solid;
        margin: 0;
        padding: 0.5em;
      }

      .left {
        float: left;
      }

      input,
      select,
      button {
        margin-top: 1em;
      }
    </style>
  </head>

  <body>
    <div>
      <fieldset>
        <legend>pinMode</legend>
        <div class="left">
          <div>
            pin: <input id="pinModePin" type="number" /> (13 for LED_BUILTIN)
          </div>
          <div>
            mode:
            <select id="pinModeMode">
              <option value="0">INPUT</option>
              <option value="1">OUTPUT</option>
              <option value="2">ANALOG</option>
              <option value="3">PWM</option>
              <option value="4">SERVO</option>
              <option value="5">SHIFT</option>
              <option value="6">I2C</option>
              <option value="7">ONEWIRE:</option>
              <option value="8">STEPPER</option>
              <option value="10">SERIAL</option>
              <option value="11">PULLUP</option>
              <option value="127">IGNORE</option>
              <option value="16" selected>UNKOWN</option>
            </select>
          </div>
          <div><button id="pinModeButton">Send</button></div>
        </div>
        <pre id="pinModeReply"></pre>
      </fieldset>

      <fieldset>
        <legend>digitalRead</legend>
        <div class="left">
          <div>pin: <input id="digitalReadPin" type="number" /></div>
          <div><button id="digitalReadButton">Send</button></div>
        </div>
        <pre id="digitalReadReply"></pre>
      </fieldset>

      <fieldset>
        <legend>digitalWrite</legend>
        <div class="left">
          <div>
            pin: <input id="digitalWritePin" type="number" /> (13 for
            LED_BUILTIN)
          </div>
          <div>output: <input id="digitalWriteOutput" type="checkbox" /></div>
          <div><button id="digitalWriteButton">Send</button></div>
        </div>
        <pre id="digitalWriteReply"></pre>
      </fieldset>
    </div>

    <script type="module">
      import {
        pinModeActionBuilder,
        digitalReadActionBuilder,
        digitalWriteActionBuilder,
      } from '/dist/actionBuilders.js';

      const postCommand = (action) =>
        fetch(
          '/command',

          {
            method: 'post',
            body: JSON.stringify(action),
            headers: { 'Content-Type': 'application/json' },
          }
        ).then((res) => res.json());

      const getNumber = (id) => parseInt(document.getElementById(id).value, 10);
      const writeReply = (where, reply) =>
        (document.getElementById(where).innerHTML = JSON.stringify(
          reply,
          null,
          2
        ));

      document.getElementById('pinModeButton').onclick = (ev) => {
        const pin = getNumber('pinModePin');
        const mode = getNumber('pinModeMode');
        postCommand(pinModeActionBuilder(pin, mode)).then((reply) => {
          writeReply('pinModeReply', reply);
        });
      };

      document.getElementById('digitalReadButton').onclick = (ev) => {
        const pin = getNumber('digitalReadPin');
        postCommand(digitalReadActionBuilder(pin)).then((reply) => {
          writeReply('digitalReadReply', reply);
        });
      };

      document.getElementById('digitalWriteButton').onclick = (ev) => {
        const pin = getNumber('digitalWritePin');
        const output = document.getElementById('digitalWriteOutput').checked
          ? 1
          : 0;
        postCommand(digitalWriteActionBuilder(pin, output)).then((reply) => {
          writeReply('digitalWriteReply', reply);
        });
      };
    </script>
  </body>
</html>
